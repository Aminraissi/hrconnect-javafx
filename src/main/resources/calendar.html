<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier des S√©minaires</title>

    <!-- ‚úÖ Fix: Use correct FullCalendar versions -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

    <script>
        function initCalendar() {
            var calendarEl = document.getElementById("calendar");

            if (!calendarEl) {
                console.error("‚ö† Error: Calendar element not found.");
                return;
            }

            console.log("‚úÖ Calendar element found. Initializing FullCalendar...");

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: "dayGridMonth",
                selectable: true,
                dateClick: function(info) {
                    console.log("üìÖ Date clicked:", info.dateStr);

                    if (window.javaApp && typeof window.javaApp.addSeminar === "function") {
                        window.javaApp.addSeminar(info.dateStr);
                    } else {
                        console.warn("‚ö† Java bridge (javaApp) is not available.");
                    }
                },
                events: []
            });

            calendar.render();

            window.loadSeminars = function (seminarsJson) {
                console.log("JavaFX called loadSeminars with data:", seminarsJson);

                try {
                    let events = JSON.parse(seminarsJson);

                    if (!Array.isArray(events)) {
                        console.error("‚ùå Invalid JSON format: Expected an array.");
                        return;
                    }

                    calendar.removeAllEvents();
                    events.forEach(event => {
                        if (!event.title || !event.start) {
                            console.warn("‚ö† Skipping invalid event:", event);
                            return;
                        }
                        calendar.addEvent(event);
                    });

                    console.log("‚úÖ Seminars loaded into calendar.");
                } catch (e) {
                    console.error("‚ùå JSON Parse Error:", e.message, "\nReceived:", seminarsJson);
                }
            };
        }

        document.addEventListener("DOMContentLoaded", function () {
            console.log("‚úÖ DOM fully loaded, initializing calendar...");
            initCalendar();
        });
    </script>

</head>
<body>
<div id="calendar"></div>
</body>
